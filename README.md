### ハンズオンラボ: Databricksでエージェントシステムを構築しよう (Databricks Assistant を利用した lite 版)

このラボは2つのパートに分かれています。**パート1**では、カスタマーサービスのシナリオ向けに様々なツールコールを持つDatabricksエージェントを AI Playground を利用しつつ構築・テストします。**パート2**では、製品に関する質問に答えるよりシンプルなエージェントを作成します。

---

**以下のノートブックはサーバレスコンピュートで実行してください。**

### パート1: 最初のエージェントを設計しよう

#### 1.1 ツールの構築
- **SQL関数**  
  - カスタマーサービスの返品ワークフローを処理するために重要なデータへアクセスするクエリを作成します。  
  - これらのSQL関数はノートブックやエージェントから簡単に呼び出せます。
- **シンプルなPython関数**  
  - 言語モデルの一般的な制限に対処するPython関数を作成します。  
  - これを「ツール」として登録し、エージェントが必要に応じて呼び出せるようにします。

#### 1.2 LLMとの統合 [AI Playground]
- **ツールとLLMの組み合わせ**  
  - Databricks AI PlaygroundでSQL/Pythonツールと大規模言語モデル（LLM）を組み合わせます。  
  - モデル: Claude 3.7 Sonnet


#### 1.3 エージェントのテスト [AI Playground]
- **システムプロンプト**: すべての会社方針が満たされるまでツールを呼び出してください。
- **質問例**: 当社の方針に基づき、キュー内の最新の返品を受け付けるべきですか？
  - エージェントの段階的な推論と最終回答を観察しましょう。
- **MLflowトレースの確認**  
  - MLflowでエージェントの実行を確認し、各ツールの呼び出し方法を理解します。  
  
---

### パート2: RAG エージェント構築

#### 2.1 新しいエージェントとリトリーバーツールの定義
- **ベクター検索**  
  - 関連する製品ドキュメントを取得するためのベクター検索インデックスを事前に用意しています。  
  - このVSインデックスは agents_lab.product.product_docs_index にあります。
- **RAGの作成**  
  - このベクター検索インデックスを関数でラップし、LLMが製品情報を検索できるようにします。  
  - 最終回答にも同じLLMを使用します。

---

### 次のステップ
- **[agent-workshop](https://github.com/taka-yayoi/agents-workshop/)** でエージェントの評価手法を学び、高品質な AI エージェントの構築方法を学びましょう。
- **[Databricks AI Dev Kit](https://github.com/databricks-solutions/ai-dev-kit/)** で更に Databricks を活用した AI コーディングを加速し、望む AI エージェントを素早く品質良く構築しましょう。
- **さらなるツールの活用**: API、高度なPython関数、追加のSQLエンドポイントでエージェントを拡張しましょう。  
- **本番展開**: 継続的インテグレーション/デリバリー（CI/CD）を導入し、MLflowでパフォーマンスを監視、モデルバージョンを管理しましょう。

---
